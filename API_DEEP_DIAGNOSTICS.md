# üî¨ –ì–ª—É–±–æ–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤—Å–µ—Ö API endpoints

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è](#–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)
2. [–ü—É–±–ª–∏—á–Ω—ã–µ endpoints](#–ø—É–±–ª–∏—á–Ω—ã–µ-endpoints)
3. [–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ endpoints](#–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ-endpoints)
4. [–ü–ª–∞—Ç–µ–∂–∏](#–ø–ª–∞—Ç–µ–∂–∏)
5. [–ë–∏–ª–ª–∏–Ω–≥](#–±–∏–ª–ª–∏–Ω–≥)
6. [–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞](#—Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è-—Å–∏—Å—Ç–µ–º–∞)
7. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏)
8. [–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏](#–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ-–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏)

---

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

### 1. POST `/auth/register`

#### –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**Email:**
- ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–≤–æ–¥–∏—Ç—Å—è –∫ lowercase: `strings.ToLower(strings.TrimSpace(email))`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –≤ –ë–î
- ‚ùå **–ù–ï–¢ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∞ email** (—Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ—Ç—É)
- ‚ùå **–ù–ï–¢ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª–∏–Ω—ã email**

**Password:**
- ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ
- ‚úÖ –•–µ—à–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ bcrypt
- ‚ùå **–ù–ï–¢ –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω—ã**
- ‚ùå **–ù–ï–¢ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏**

**Referral:**
- ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ
- ‚úÖ –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω, –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞–≥—Ä–∞–¥–∞ —Ä–µ—Ñ–µ—Ä–µ—Ä—É (–µ—Å–ª–∏ –∫–æ–¥ –≤–∞–ª–∏–¥–Ω—ã–π)

#### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (201 Created)

```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIs...",
  "refresh_token": "eyJhbGciOiJIUzI1NiIs...",
  "expires_in": 900,
  "refresh_expires_at": "2025-12-16T23:00:00Z",
  "user": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "email": "user@example.com",
    "telegram_id": null,
    "roles": ["user"],
    "marzban_username": null,
    "marzban_id": null,
    "is_active": true,
    "is_admin": false,
    "referral_code": "ABC123",
    "referred_by": null,
    "created_at": "2024-11-18T20:00:00Z",
    "updated_at": "2024-11-18T20:00:00Z"
  },
  "roles": ["user"]
}
```

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:**
- `expires_in` - –≤ **—Å–µ–∫—É–Ω–¥–∞—Ö** (900 = 15 –º–∏–Ω—É—Ç)
- `refresh_expires_at` - ISO 8601 —Ñ–æ—Ä–º–∞—Ç
- `user.id` - UUID —Å—Ç—Ä–æ–∫–∞
- `user.email` - –º–æ–∂–µ—Ç –±—ã—Ç—å `null` –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ Telegram
- `user.roles` - –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫, –≤—Å–µ–≥–¥–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –º–∏–Ω–∏–º—É–º `["user"]`
- –ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è trial –∫–ª–∏–µ–Ω—Ç** (48 —á–∞—Å–æ–≤), –Ω–æ –æ—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é (–ª–æ–≥–∏—Ä—É–µ—Ç—Å—è warning)

#### –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏

**400 Bad Request:**
```json
{
  "message": "invalid body"
}
```
- –ü—Ä–∏—á–∏–Ω–∞: –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π

**400 Bad Request:**
```json
{
  "message": "email already exists"
}
```
- –ü—Ä–∏—á–∏–Ω–∞: Email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω (–ø–æ—Å–ª–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è –∫ lowercase)

**500 Internal Server Error:**
```json
{
  "message": "could not issue tokens"
}
```
- –ü—Ä–∏—á–∏–Ω–∞: –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ JWT —Ç–æ–∫–µ–Ω–æ–≤

#### Edge Cases

1. **–ü—É—Å—Ç–æ–π email –∏–ª–∏ password:**
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `400 Bad Request` —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º `"invalid body"` –∏–ª–∏ `"email already exists"`

2. **Email —Å –ø—Ä–æ–±–µ–ª–∞–º–∏:**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–µ–∑–∞—é—Ç—Å—è: `"  User@Example.com  "` ‚Üí `"user@example.com"`

3. **Email —Å —Ä–∞–∑–Ω—ã–º —Ä–µ–≥–∏—Å—Ç—Ä–æ–º:**
   - `"User@Example.com"` –∏ `"user@example.com"` - —ç—Ç–æ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ email

4. **–†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥:**
   - –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π –∫–æ–¥, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ —Ä–∞–≤–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç, –Ω–æ –Ω–∞–≥—Ä–∞–¥–∞ –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è (–ª–æ–≥–∏—Ä—É–µ—Ç—Å—è warning)
   - –ï—Å–ª–∏ –∫–æ–¥ –≤–∞–ª–∏–¥–Ω—ã–π, —Å–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `referrals` –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞–≥—Ä–∞–¥–∞

5. **–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è trial –∫–ª–∏–µ–Ω—Ç–∞:**
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ, –Ω–æ trial –∫–ª–∏–µ–Ω—Ç –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è (–ª–æ–≥–∏—Ä—É–µ—Ç—Å—è warning)

6. **–û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π –Ω–∞–≥—Ä–∞–¥—ã:**
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ, –Ω–æ –Ω–∞–≥—Ä–∞–¥–∞ –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è (–ª–æ–≥–∏—Ä—É–µ—Ç—Å—è warning)

---

### 2. POST `/auth/login`

#### –í–∞–ª–∏–¥–∞—Ü–∏—è

**Email:**
- ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ
- ‚úÖ –ü—Ä–∏–≤–æ–¥–∏—Ç—Å—è –∫ lowercase –∏ –æ–±—Ä–µ–∑–∞—é—Ç—Å—è –ø—Ä–æ–±–µ–ª—ã: `strings.ToLower(strings.TrimSpace(email))`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –≤ –ë–î

**Password:**
- ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ bcrypt

#### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (200 OK)

**–ê–Ω–∞–ª–æ–≥–∏—á–µ–Ω `/auth/register`**, –Ω–æ:
- –°—Ç–∞—Ç—É—Å –∫–æ–¥: `200` –≤–º–µ—Å—Ç–æ `201`
- `user` –æ–±—ä–µ–∫—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î

#### –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏

**400 Bad Request:**
```json
{
  "message": "invalid body"
}
```

**401 Unauthorized:**
```json
{
  "message": "invalid login"
}
```
- –ü—Ä–∏—á–∏–Ω–∞: –ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ password
- **–í–∞–∂–Ω–æ:** –û–¥–∏–Ω–∞–∫–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö —Å–ª—É—á–∞–µ–≤ (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - –Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω–µ–≤–µ—Ä–Ω–æ)

**401 Unauthorized:**
```json
{
  "message": "user inactive"
}
```
- –ü—Ä–∏—á–∏–Ω–∞: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω (`is_active = false`)

#### Edge Cases

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–µ–∑ password_hash:**
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `401` —Å `"invalid login"` (–Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç –ø—Ä–∏—á–∏–Ω—É)

2. **Email —Å —Ä–∞–∑–Ω—ã–º —Ä–µ–≥–∏—Å—Ç—Ä–æ–º:**
   - `"User@Example.com"` –∏ `"user@example.com"` - —ç—Ç–æ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ email

3. **–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:**
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `401` —Å `"user inactive"`, –¥–∞–∂–µ –µ—Å–ª–∏ –ø–∞—Ä–æ–ª—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

4. **–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å:**
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `401` —Å `"invalid login"` (–Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç, —á—Ç–æ –ø–∞—Ä–æ–ª—å –Ω–µ–≤–µ—Ä–Ω—ã–π)

---

### 3. POST `/auth/refresh`

#### –í–∞–ª–∏–¥–∞—Ü–∏—è

**RefreshToken:**
- ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –≤ –ë–î
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–æ–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è (`refresh_expires_at > now()`)

#### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (200 OK)

**–ê–Ω–∞–ª–æ–≥–∏—á–µ–Ω `/auth/login`** - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:**
- –ü—Ä–∏ –∫–∞–∂–¥–æ–º refresh –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è **–Ω–æ–≤—ã–π refresh token**
- –°—Ç–∞—Ä—ã–π refresh token **–ù–ï –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è** (–æ—Å—Ç–∞–µ—Ç—Å—è –≤ –ë–î, –Ω–æ –Ω–æ–≤—ã–π –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –ø–æ–≤–µ—Ä—Ö)

#### –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏

**400 Bad Request:**
```json
{
  "message": "refresh_token required"
}
```

**401 Unauthorized:**
```json
{
  "message": "invalid refresh token"
}
```
- –ü—Ä–∏—á–∏–Ω–∞: –¢–æ–∫–µ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å—Ç–µ–∫ –∏–ª–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π

#### Edge Cases

1. **–ò—Å—Ç–µ–∫—à–∏–π refresh token:**
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `401` —Å `"invalid refresh token"`

2. **Refresh token = null –≤ –ë–î:**
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `401` —Å `"invalid refresh token"`

3. **–ù–æ–≤—ã–π refresh token:**
   - –ü—Ä–∏ –∫–∞–∂–¥–æ–º refresh –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è **–Ω–æ–≤—ã–π refresh token**
   - –°—Ç–∞—Ä—ã–π —Ç–æ–∫–µ–Ω –æ—Å—Ç–∞–µ—Ç—Å—è –≤ –ë–î, –Ω–æ –Ω–æ–≤—ã–π –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –ø–æ–≤–µ—Ä—Ö (—Å—Ç–∞—Ä—ã–π —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º)

---

### 4. POST `/auth/logout`

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –û–±–Ω–æ–≤–ª—è–µ—Ç `refresh_token` –≤ –ë–î –Ω–∞ –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É `""`
- –û–±–Ω–æ–≤–ª—è–µ—Ç `refresh_expires_at` –Ω–∞ `time.Time{}` (–Ω—É–ª–µ–≤–æ–µ –≤—Ä–µ–º—è)

#### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞

**204 No Content** (–ø—É—Å—Ç–æ–µ —Ç–µ–ª–æ)

#### –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏

**400 Bad Request:**
```json
{
  "message": "refresh_token required"
}
```

**401 Unauthorized:**
```json
{
  "message": "invalid refresh token"
}
```

**500 Internal Server Error:**
```json
{
  "message": "invalid user id"
}
```
–∏–ª–∏
```json
{
  "message": "could not revoke token"
}
```

#### Edge Cases

1. **Logout —Å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º:**
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `401`, –Ω–æ —ç—Ç–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ (—Ç–æ–∫–µ–Ω —É–∂–µ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π)

2. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ logout:**
   - –ú–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Å –æ–¥–Ω–∏–º —Ç–æ–∫–µ–Ω–æ–º (idempotent)

---

### 5. GET `/me`

#### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (200 OK)

```json
{
  "uid": "550e8400-e29b-41d4-a716-446655440000",
  "user_id": "550e8400-e29b-41d4-a716-446655440000",
  "roles": ["user"],
  "exp": 1734567890,
  "iat": 1734566990
}
```

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:**
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç **JWT claims**, –∞ –Ω–µ –ø–æ–ª–Ω—ã–π –æ–±—ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `uid` –∏ `user_id` - –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–¥—É–±–ª–∏–∫–∞—Ç)
- `exp` –∏ `iat` - Unix timestamp (—Å–µ–∫—É–Ω–¥—ã)
- **–ù–ï–¢ email, telegram_id –∏ –¥—Ä—É–≥–∏—Ö –ø–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
- –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `/profile`

#### –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏

**401 Unauthorized:**
```json
{
  "message": "missing claims"
}
```
- –ü—Ä–∏—á–∏–Ω–∞: –¢–æ–∫–µ–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π

**401 Unauthorized:**
```json
{
  "message": "code=401, message=invalid or expired jwt"
}
```
- –ü—Ä–∏—á–∏–Ω–∞: –¢–æ–∫–µ–Ω –∏—Å—Ç–µ–∫ –∏–ª–∏ –ø–æ–¥–ø–∏—Å—å –Ω–µ–≤–µ—Ä–Ω–∞—è

---

## üåê –ü—É–±–ª–∏—á–Ω—ã–µ endpoints

### 6. GET `/tariffs`

#### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (200 OK)

```json
[
  {
    "id": "1",
    "code": "basic_month",
    "name": "–¢–∞—Ä–∏—Ñ –ë–∞–º–±—É–∫",
    "description": "–õ—ë–≥–∫–∏–π, –∫–∞–∫ –ø–µ—Ä–≤—ã–π —à–∞–≥ –ü–∞–Ω–¥—ã –Ω–∞ –ø—É—Ç—å –≤–æ–∏–Ω–∞",
    "price_amount": 14900,
    "currency": "RUB",
    "duration_seconds": 2592000,
    "created_at": "2024-01-01T00:00:00Z",
    "updated_at": "2024-01-01T00:00:00Z"
  }
]
```

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:**
- `price_amount` - –≤ **–∫–æ–ø–µ–π–∫–∞—Ö** (14900 = 149‚ÇΩ)
- `duration_seconds` - –≤ **—Å–µ–∫—É–Ω–¥–∞—Ö** (2592000 = 30 –¥–Ω–µ–π)
- `description` - –º–æ–∂–µ—Ç –±—ã—Ç—å `null`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–º–∞—Å—Å–∏–≤**, –¥–∞–∂–µ –µ—Å–ª–∏ —Ç–∞—Ä–∏—Ñ–æ–≤ –Ω–µ—Ç (–ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ `[]`)

#### –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏

**500 Internal Server Error:**
```json
{
  "message": "failed to list tariffs"
}
```

#### Edge Cases

1. **–ù–µ—Ç —Ç–∞—Ä–∏—Ñ–æ–≤:**
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `200 OK` —Å –ø—É—Å—Ç—ã–º –º–∞—Å—Å–∏–≤–æ–º `[]`

---

### 7. GET `/nodes`

#### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (200 OK)

```json
[
  {
    "id": "node-1",
    "name": "Moscow",
    "status": "online"
  }
]
```

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:**
- **–•–∞—Ä–¥–∫–æ–¥–Ω—ã–π –æ—Ç–≤–µ—Ç** - –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–¥–∏–Ω —É–∑–µ–ª
- **–ù–ï –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏** –∏–∑ –ë–î –∏–ª–∏ Marzban
- –≠—Ç–æ **–∑–∞–≥–ª—É—à–∫–∞** –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
- –§—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–æ–ª–∂–µ–Ω –ø–æ–Ω–∏–º–∞—Ç—å, —á—Ç–æ —ç—Ç–æ –Ω–µ —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

---

## üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ endpoints

### 8. GET `/profile`

#### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (200 OK)

```json
{
  "user": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "email": "user@example.com",
    "telegram_id": null,
    "roles": ["user"],
    "marzban_username": "user_123"
  },
  "stats": {
    "clients_total": 2
  },
  "clients": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "user_id": "550e8400-e29b-41d4-a716-446655440000",
      "marzban_client_id": "marzban_123",
      "protocol": "vless",
      "transport": "ws",
      "created_at": "2024-01-01T00:00:00Z",
      "expires_at": "2024-02-01T00:00:00Z",
      "active": true,
      "subscription_url": "https://example.com/sub",
      "config_text": "vless://..."
    }
  ]
}
```

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:**
- `clients` - –º–∞—Å—Å–∏–≤ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `marzban_clients` (–ù–ï –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `clients`)
- –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–µ—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ `[]`
- `clients_total` = `len(clients)` (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤ –º–∞—Å—Å–∏–≤–µ)
- `user.email` –º–æ–∂–µ—Ç –±—ã—Ç—å `null` (–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ Telegram)
- `user.telegram_id` –º–æ–∂–µ—Ç –±—ã—Ç—å `null`
- `user.marzban_username` –º–æ–∂–µ—Ç –±—ã—Ç—å `null`
- `clients[].transport` –º–æ–∂–µ—Ç –±—ã—Ç—å `null` (—É–∫–∞–∑–∞—Ç–µ–ª—å)
- `clients[].expires_at` –º–æ–∂–µ—Ç –±—ã—Ç—å `null`
- `clients[].subscription_url` –º–æ–∂–µ—Ç –±—ã—Ç—å `null`
- `clients[].config_text` –º–æ–∂–µ—Ç –±—ã—Ç—å `null`

#### –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏

**401 Unauthorized:**
```json
{
  "message": "missing claims"
}
```

**404 Not Found:**
```json
{
  "message": "user not found"
}
```

**400 Bad Request:**
```json
{
  "message": "invalid user id"
}
```

#### Edge Cases

1. **–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤:**
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ `[]` –≤–º–µ—Å—Ç–æ –æ—à–∏–±–∫–∏ (–ª–æ–≥–∏—Ä—É–µ—Ç—Å—è error)
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ

2. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±–µ–∑ –∫–ª–∏–µ–Ω—Ç–æ–≤:**
   - `clients: []`, `clients_total: 0`

3. **–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ UUID:**
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `400 Bad Request` —Å `"invalid user id"`

---

### 9. GET `/profile/keys`

#### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (200 OK)

```json
[
  {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "user_id": "550e8400-e29b-41d4-a716-446655440000",
    "marzban_client_id": "marzban_123",
    "protocol": "vless",
    "transport": "ws",
    "created_at": "2024-01-01T00:00:00Z",
    "expires_at": "2024-02-01T00:00:00Z",
    "active": true,
    "subscription_url": "https://example.com/sub",
    "config_text": "vless://..."
  }
]
```

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:**
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç **–º–∞—Å—Å–∏–≤** –æ–±—ä–µ–∫—Ç–æ–≤ `MarzbanClient`
- –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–µ—Ç, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ `[]`
- `transport` –º–æ–∂–µ—Ç –±—ã—Ç—å `null` (—É–∫–∞–∑–∞—Ç–µ–ª—å)
- `expires_at` –º–æ–∂–µ—Ç –±—ã—Ç—å `null`
- `subscription_url` –º–æ–∂–µ—Ç –±—ã—Ç—å `null`
- `config_text` –º–æ–∂–µ—Ç –±—ã—Ç—å `null`
- –≠—Ç–æ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `marzban_clients` (–ù–ï `clients`)

#### Edge Cases

1. **–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:**
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ `[]` (–ª–æ–≥–∏—Ä—É–µ—Ç—Å—è error)

2. **–ö–ª–∏–µ–Ω—Ç –±–µ–∑ transport:**
   - `transport: null` –≤ JSON

---

### 10. GET `/profile/usage`

#### Query Parameters

- `client_id` (optional) - ID –∫–ª–∏–µ–Ω—Ç–∞ –∏–∑ Marzban (marzban_client_id)

#### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (200 OK)

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:** –§–æ—Ä–º–∞—Ç –∑–∞–≤–∏—Å–∏—Ç –æ—Ç Marzban API. –¢–∏–ø–∏—á–Ω—ã–π –æ—Ç–≤–µ—Ç:

```json
{
  "up": 1073741824,
  "down": 2147483648,
  "total": 3221225472
}
```

**–ò–ª–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å:**
```json
{
  "client_id": "marzban_123",
  "up": 1073741824,
  "down": 2147483648,
  "total": 3221225472,
  "expires": "2024-02-01T00:00:00Z"
}
```

**–í–∞–∂–Ω–æ:**
- –§–æ—Ä–º–∞—Ç **–Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω** - –∑–∞–≤–∏—Å–∏—Ç –æ—Ç Marzban
- –ï—Å–ª–∏ `client_id` –Ω–µ —É–∫–∞–∑–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–µ—Ä–≤—ã–π –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ó–Ω–∞—á–µ–Ω–∏—è –≤ **–±–∞–π—Ç–∞—Ö**

#### –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏

**400 Bad Request:**
```json
{
  "message": "invalid user id"
}
```

**404 Not Found:**
```json
{
  "message": "no clients found"
}
```

**403 Forbidden:**
```json
{
  "message": "client does not belong to user"
}
```

**502 Bad Gateway:**
```json
{
  "message": "failed to fetch usage"
}
```
- –ü—Ä–∏—á–∏–Ω–∞: Marzban –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É

#### Edge Cases

1. **–ù–µ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤:**
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `404` —Å `"no clients found"`

2. **client_id –Ω–µ —É–∫–∞–∑–∞–Ω:**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–µ—Ä–µ—Ç—Å—è –ø–µ—Ä–≤—ã–π –∫–ª–∏–µ–Ω—Ç –∏–∑ —Å–ø–∏—Å–∫–∞ (`clients[0].MarzbanClientID`)

3. **client_id –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:**
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `403` —Å `"client does not belong to user"`

4. **Marzban –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:**
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `502` —Å `"failed to fetch usage"`

---

### 11. GET `/me/clients`

#### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (200 OK)

```json
[
  {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "uuid_key": "550e8400-e29b-41d4-a716-446655440000",
    "protocol": "vless",
    "transport": "tcp",
    "flow": "xtls-rprx-vision",
    "status": "active",
    "expires_at": "2024-02-01T00:00:00Z"
  }
]
```

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:**
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `clients` (–ù–ï `marzban_clients`)
- –≠—Ç–æ **–¥—Ä—É–≥–∞—è —Ç–∞–±–ª–∏—Ü–∞**, —á–µ–º –≤ `/profile/keys`
- `expires_at` –º–æ–∂–µ—Ç –±—ã—Ç—å `null`
- `status` - —Å—Ç—Ä–æ–∫–∞ (`"active"`, `"revoked"`, –∏ —Ç.–¥.)
- **–ù–ï–¢ –ø–æ–ª–µ–π:** `marzban_client_id`, `subscription_url`, `config_text`, `active`

#### –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏

**500 Internal Server Error:**
```json
{
  "message": "could not list clients"
}
```

#### Edge Cases

1. **–ù–µ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤:**
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ `[]`

2. **–†–∞–∑–Ω–∏—Ü–∞ —Å `/profile/keys`:**
   - `/me/clients` - –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `clients` (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—ã)
   - `/profile/keys` - –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `marzban_clients` (–∫–ª–∏–µ–Ω—Ç—ã –∏–∑ Marzban)
   - –≠—Ç–æ **—Ä–∞–∑–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö** –∏ –º–æ–≥—É—Ç –Ω–µ —Å–æ–≤–ø–∞–¥–∞—Ç—å!

---

### 12. POST `/me/clients`

#### Request Body

```json
{
  "protocol": "vless",
  "transport": "tcp",
  "flow": "xtls-rprx-vision",
  "node_id": "1",
  "meta": {
    "device": "iPhone",
    "os": "iOS 17"
  }
}
```

**–ü–æ–ª—è:**
- `protocol` (required) - —Å—Ç—Ä–æ–∫–∞
- `transport` (required) - —Å—Ç—Ä–æ–∫–∞
- `flow` (required) - —Å—Ç—Ä–æ–∫–∞
- `node_id` (optional) - —Å—Ç—Ä–æ–∫–∞ –∏–ª–∏ null
- `meta` (optional) - –æ–±—ä–µ–∫—Ç (–ª—é–±—ã–µ –∫–ª—é—á–∏-–∑–Ω–∞—á–µ–Ω–∏—è)

#### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (201 Created)

```json
{
  "client_id": "550e8400-e29b-41d4-a716-446655440000",
  "uuid": "550e8400-e29b-41d4-a716-446655440000"
}
```

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:**
- `client_id` –∏ `uuid` - —ç—Ç–æ **—Ä–∞–∑–Ω—ã–µ UUID** (–≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ)
- `client_id` - ID –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ `clients` (–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π UUID)
- `uuid` - UUID –∫–ª—é—á –¥–ª—è VPN –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫–æ–Ω—Ñ–∏–≥–∞—Ö)
- –ö–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–µ—Ç—Å—è —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `"active"`
- `expires_at` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω `ExpiresIn` (–≤ –∫–æ–¥–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–∑ request, —Ç–æ–ª—å–∫–æ –ø—Ä–∏ `EnsureTrial`)

#### –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏

**400 Bad Request:**
```json
{
  "message": "invalid body"
}
```

**400 Bad Request:**
```json
{
  "message": "<error from CreateClient>"
}
```
- –ú–æ–∂–µ—Ç –±—ã—Ç—å –æ—à–∏–±–∫–∞ –ë–î –∏–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

#### Edge Cases

1. **meta = null:**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ `{}`

2. **–û—à–∏–±–∫–∞ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ meta:**
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `400` —Å –æ—à–∏–±–∫–æ–π

3. **node_id = null:**
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ `NULL` –≤ –ë–î

4. **ExpiresIn –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:**
   - –ü–æ–ª–µ `ExpiresIn` –≤ request –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ `EnsureTrial`)

---

### 13. POST `/me/clients/:id/revoke`

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –û–±–Ω–æ–≤–ª—è–µ—Ç `status = 'revoked'` –≤ —Ç–∞–±–ª–∏—Ü–µ `clients`
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∫–ª–∏–µ–Ω—Ç –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

#### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞

**204 No Content** (–ø—É—Å—Ç–æ–µ —Ç–µ–ª–æ)

#### –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏

**400 Bad Request:**
```json
{
  "message": "id required"
}
```

**404 Not Found:**
```json
{
  "message": "client not found"
}
```
- –ü—Ä–∏—á–∏–Ω–∞: –ö–ª–∏–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

#### Edge Cases

1. **–ü–æ–≤—Ç–æ—Ä–Ω—ã–π revoke:**
   - –ú–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ (idempotent)

2. **–ö–ª–∏–µ–Ω—Ç –¥—Ä—É–≥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `404` (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - –Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ)

---

### 14. GET `/vpn/config/:client_id`

#### Path Parameters

- `client_id` (required) - Marzban client ID (–ù–ï –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π UUID)

#### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (200 OK)

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:** –§–æ—Ä–º–∞—Ç –∑–∞–≤–∏—Å–∏—Ç –æ—Ç Marzban API. –¢–∏–ø–∏—á–Ω—ã–π –æ—Ç–≤–µ—Ç:

```json
{
  "id": "marzban_123",
  "username": "user_123",
  "protocol": "vless",
  "config": "vless://uuid@server:port?type=ws&path=/path#name",
  "subscription_url": "https://example.com/sub"
}
```

**–í–∞–∂–Ω–æ:**
- `client_id` –≤ path - —ç—Ç–æ **Marzban ID**, –Ω–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π UUID
- –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ **–Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω** - –∑–∞–≤–∏—Å–∏—Ç –æ—Ç Marzban

#### –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏

**400 Bad Request:**
```json
{
  "message": "client_id required"
}
```

**404 Not Found:**
```json
{
  "message": "client not found"
}
```

**403 Forbidden:**
```json
{
  "message": "not allowed"
}
```

**502 Bad Gateway:**
```json
{
  "message": "marzban unavailable"
}
```

---

## üí≥ –ü–ª–∞—Ç–µ–∂–∏

### 15. POST `/payments/create`

#### Request Body

```json
{
  "tariff_code": "basic_month",
  "payment_method": "yookassa",
  "return_url": "https://pandavpn.com/dashboard"
}
```

**–ü–æ–ª—è:**
- `tariff_code` (required) - –∫–æ–¥ —Ç–∞—Ä–∏—Ñ–∞
- `payment_method` (optional) - –º–µ—Ç–æ–¥ –æ–ø–ª–∞—Ç—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞)
- `return_url` (optional) - URL –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã

#### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (200 OK)

```json
{
  "invoice_id": "inv_123",
  "payment_id": "pay_456",
  "payment_url": "https://yookassa.ru/checkout/payments/...",
  "provider_payment_id": "yookassa_789",
  "status": "pending"
}
```

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:**
- `payment_url` - URL –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `status` - —Å—Ç–∞—Ç—É—Å –∏–Ω–≤–æ–π—Å–∞ (`"pending"`, `"paid"`, `"failed"`)
- `provider_payment_id` - ID –ø–ª–∞—Ç–µ–∂–∞ –≤ —Å–∏—Å—Ç–µ–º–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
- –ü–ª–∞—Ç–µ–∂ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ** —á–µ—Ä–µ–∑ worker

#### –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏

**400 Bad Request:**
```json
{
  "message": "invalid body"
}
```

**400 Bad Request:**
```json
{
  "message": "tariff_code required"
}
```

**400 Bad Request:**
```json
{
  "message": "unsupported payment method"
}
```

**400 Bad Request:**
```json
{
  "message": "<error from CreateInvoiceAndPayment>"
}
```

#### Edge Cases

1. **payment_method –Ω–µ —É–∫–∞–∑–∞–Ω:**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–µ—Ä–µ—Ç—Å—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ (`PaymentsProvider`)

2. **payment_method –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –∫–æ–Ω—Ñ–∏–≥–æ–º:**
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `400` —Å `"unsupported payment method"`

3. **–¢–∞—Ä–∏—Ñ –Ω–µ –Ω–∞–π–¥–µ–Ω:**
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `400` —Å –æ—à–∏–±–∫–æ–π –æ—Ç `CreateInvoiceAndPayment`

---

### 16. GET `/payments/:id`

#### Path Parameters

- `id` (required) - ID –∏–Ω–≤–æ–π—Å–∞

#### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (200 OK)

```json
{
  "invoice": {
    "id": "inv_123",
    "user_id": "550e8400-e29b-41d4-a716-446655440000",
    "tariff_id": "1",
    "amount": 14900,
    "currency": "RUB",
    "status": "paid",
    "external_id": null,
    "metadata": {},
    "created_at": "2024-01-01T00:00:00Z",
    "updated_at": "2024-01-01T00:00:00Z"
  },
  "payments": [
    {
      "id": "pay_456",
      "invoice_id": "inv_123",
      "provider": "yookassa",
      "provider_payment_id": "yookassa_789",
      "amount": 14900,
      "currency": "RUB",
      "status": "succeeded",
      "raw_payload": {},
      "created_at": "2024-01-01T00:00:00Z",
      "updated_at": "2024-01-01T00:00:00Z"
    }
  ]
}
```

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:**
- `invoice.amount` - –≤ **–∫–æ–ø–µ–π–∫–∞—Ö**
- `payments` - –º–∞—Å—Å–∏–≤ –≤—Å–µ—Ö –ø–ª–∞—Ç–µ–∂–µ–π –ø–æ –∏–Ω–≤–æ–π—Å—É
- `invoice.user_id` –º–æ–∂–µ—Ç –±—ã—Ç—å `null`
- `invoice.tariff_id` –º–æ–∂–µ—Ç –±—ã—Ç—å `null`
- `invoice.metadata` - JSON bytes (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º –æ–±—ä–µ–∫—Ç–æ–º)

#### –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏

**400 Bad Request:**
```json
{
  "message": "id required"
}
```

**404 Not Found:**
```json
{
  "message": "invoice not found"
}
```

**403 Forbidden:**
```json
{
  "message": "not allowed"
}
```
- –ü—Ä–∏—á–∏–Ω–∞: –ò–Ω–≤–æ–π—Å –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –¥—Ä—É–≥–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

---

### 17. POST `/vpn/renew` –∏ 18. POST `/vpn/topup`

**–ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã `/payments/create`**, –Ω–æ:
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—é—Ç `client_id` (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω)
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–æ—Ç –∂–µ handler `createTariffInvoice`

---

## üí∞ –ë–∏–ª–ª–∏–Ω–≥

### 19. GET `/billing/state/:client_id`

#### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (200 OK)

```json
{
  "state": {
    "client_id": "client_1",
    "user_id": "550e8400-e29b-41d4-a716-446655440000",
    "status": "active",
    "expires_at": "2024-02-01T00:00:00Z",
    "last_sync": "2024-01-15T12:00:00Z",
    "auto_renew": false,
    "last_payment_id": "pay_456",
    "created_at": "2024-01-01T00:00:00Z",
    "updated_at": "2024-01-01T00:00:00Z"
  },
  "events": [
    {
      "id": "event_1",
      "payment_id": "pay_456",
      "event_type": "payment_received",
      "reason": null,
      "raw_payload": {},
      "created_at": "2024-01-01T00:00:00Z"
    }
  ]
}
```

**–í–∞–∂–Ω–æ:**
- `expires_at` –º–æ–∂–µ—Ç –±—ã—Ç—å `null`
- `last_sync` –º–æ–∂–µ—Ç –±—ã—Ç—å `null`
- `last_payment_id` –º–æ–∂–µ—Ç –±—ã—Ç—å `null`
- `events` - –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å–æ–±—ã—Ç–∏–π
- `status` - —Å—Ç—Ä–æ–∫–∞ (`"active"`, `"expired"`, `"suspended"`)

---

### 20. GET `/billing/history`

#### Query Parameters

- `page` (optional, default: 1) - –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- `limit` (optional, default: 20) - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π

#### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (200 OK)

```json
{
  "page": 1,
  "limit": 20,
  "items": [...]
}
```

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:**
- `page` –∏ `limit` –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ –æ—Ç–≤–µ—Ç–µ, –Ω–æ **–ø–∞–≥–∏–Ω–∞—Ü–∏—è –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞**
- –í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤—Å–µ –∑–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `limit` –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è

---

## üéÅ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

### 21. GET `/referral/link`

#### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (200 OK)

```json
{
  "referral_link": "https://example.com/register?ref=ABC123"
}
```

**–í–∞–∂–Ω–æ:**
- –§–æ—Ä–º–∞—Ç: `{appDomain}/register?ref={referral_code}`
- `referral_code` –±–µ—Ä–µ—Ç—Å—è –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `users.referral_code`

---

### 22. GET `/referral/stats`

#### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (200 OK)

```json
{
  "total_referrals": 5,
  "total_rewards": 15000,
  "processed_rewards": 3,
  "pending_rewards": 2
}
```

**–í–∞–∂–Ω–æ:**
- `total_rewards` - —Å—É–º–º–∞ –≤ –∫–æ–ø–µ–π–∫–∞—Ö (15000 = 150‚ÇΩ)

---

### 23. GET `/referral/rewards`

#### Query Parameters

- `limit` (optional, default: 20, max: 100) - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
- `offset` (optional, default: 0) - —Å–º–µ—â–µ–Ω–∏–µ

#### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (200 OK)

```json
{
  "rewards": [...],
  "limit": 20,
  "offset": 0
}
```

**–í–∞–∂–Ω–æ:**
- `limit` –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –º–∞–∫—Å–∏–º—É–º–æ–º 100
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è **—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞** (–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π endpoint —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π)

---

## üì• –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### 24-28. GET `/configs/:client_id/{format}`

#### –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:

- `/vless` - —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª (`text/plain`)
- `/vmess` - JSON —Ñ–∞–π–ª (`application/json`)
- `/qr` - PNG –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (`image/png`)
- `/hiddify` - JSON —Ñ–∞–π–ª (`application/json`)
- `/clash` - YAML —Ñ–∞–π–ª (`application/x-yaml`)

#### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞

**200 OK** —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º Content-Type –∏ blob –¥–∞–Ω–Ω—ã–º–∏

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:**
- `client_id` –≤ path - —ç—Ç–æ **Marzban ID**, –Ω–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π UUID
- –§–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ –¥–∏—Å–∫ –≤ `./files/configs/`
- –ï—Å–ª–∏ —Ñ–∞–π–ª —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π

---

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–°–û–ë–ï–ù–ù–û–°–¢–ò

### 1. –î–≤–µ —Ç–∞–±–ª–∏—Ü—ã –∫–ª–∏–µ–Ω—Ç–æ–≤

**–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:**
- –¢–∞–±–ª–∏—Ü–∞ `clients` - –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—ã (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `/me/clients`)
- –¢–∞–±–ª–∏—Ü–∞ `marzban_clients` - –∫–ª–∏–µ–Ω—Ç—ã –∏–∑ Marzban (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `/profile/keys`, `/configs/*`)

**–≠—Ç–æ —Ä–∞–∑–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –º–æ–≥—É—Ç –Ω–µ —Å–æ–≤–ø–∞–¥–∞—Ç—å!**

### 2. –§–æ—Ä–º–∞—Ç—ã ID

- **–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π UUID:** `550e8400-e29b-41d4-a716-446655440000` (–∏–∑ —Ç–∞–±–ª–∏—Ü—ã `clients` –∏–ª–∏ `marzban_clients.id`)
- **Marzban ID:** `marzban_123` (–∏–∑ `marzban_clients.marzban_client_id`)
- **Client ID –≤ `/me/clients`:** UUID –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `clients`
- **Client ID –≤ `/configs/*`:** Marzban ID –∏–∑ `marzban_clients.marzban_client_id`

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–ü–∞—Ç—Ç–µ—Ä–Ω:**
- –í—Å–µ –æ—à–∏–±–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –∫–∞–∫ `{"message": "..."}`
- –ù–ï–¢ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ (—Ç–æ–ª—å–∫–æ –æ–±—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ)
- 401/403 –æ—à–∏–±–∫–∏ –Ω–µ —Ä–∞—Å–∫—Ä—ã–≤–∞—é—Ç –ø—Ä–∏—á–∏–Ω—É (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)

### 4. Nullable –ø–æ–ª—è

–ú–Ω–æ–≥–∏–µ –ø–æ–ª—è –º–æ–≥—É—Ç –±—ã—Ç—å `null`:
- `email`, `telegram_id`, `marzban_username` –≤ User
- `transport`, `expires_at`, `subscription_url`, `config_text` –≤ MarzbanClient
- `node_id`, `flow`, `expires_at` –≤ Client
- `user_id`, `tariff_id` –≤ Invoice

### 5. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è

- **–ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è trial –∫–ª–∏–µ–Ω—Ç (48 —á–∞—Å–æ–≤)
- **–ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞ (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω –∫–æ–¥)
- **–ü—Ä–∏ –æ–ø–ª–∞—Ç–µ:** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ worker (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)

### 6. –¢–æ–∫–µ–Ω—ã

- **Access token:** 15 –º–∏–Ω—É—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- **Refresh token:** 720 —á–∞—Å–æ–≤ (30 –¥–Ω–µ–π) –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –ü—Ä–∏ –∫–∞–∂–¥–æ–º refresh –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è **–Ω–æ–≤—ã–π refresh token**
- –°—Ç–∞—Ä—ã–π refresh token **–∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è** (–Ω–æ–≤—ã–π –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –ø–æ–≤–µ—Ä—Ö)

### 7. –†–æ–ª–∏

- –í—Å–µ–≥–¥–∞ –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è: –º–∏–Ω–∏–º—É–º `["user"]`
- –ï—Å–ª–∏ `is_admin = true`, –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Ä–æ–ª—å `"admin"`
- –†–æ–ª–∏ –∏–∑ –ë–î –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏

### 8. –ü–∞–≥–∏–Ω–∞—Ü–∏—è

- **–ù–ï —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞** –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ endpoints
- `/referral/rewards` - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π endpoint —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
- `/billing/history` - –∏–º–µ–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `page` –∏ `limit`, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏—Ö

### 9. –í–∞–ª–∏–¥–∞—Ü–∏—è

- **Email:** —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ—Ç—É –∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ (–ù–ï–¢ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–æ—Ä–º–∞—Ç–∞)
- **Password:** —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ—Ç—É (–ù–ï–¢ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª–∏–Ω—ã/—Å–ª–æ–∂–Ω–æ—Å—Ç–∏)
- **UUID:** –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –ø—Ä–∏ –ø–∞—Ä—Å–∏–Ω–≥–µ
- **Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:** –±–∞–∑–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ (—Ç–∏–ø, –¥–∏–∞–ø–∞–∑–æ–Ω)

---

## üìä –°–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ endpoints

| Endpoint | –ú–µ—Ç–æ–¥ | Auth | –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö | –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ | –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ |
|----------|-------|------|-----------------|---------------|-------------|
| `/auth/register` | POST | ‚ùå | `users` | TokenResponse | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç trial |
| `/auth/login` | POST | ‚ùå | `users` | TokenResponse | - |
| `/auth/refresh` | POST | ‚ùå | `users` | TokenResponse | –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–π refresh token |
| `/auth/logout` | POST | ‚úÖ | `users` | 204 | –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç refresh token |
| `/me` | GET | ‚úÖ | JWT claims | Claims | –¢–æ–ª—å–∫–æ claims, –Ω–µ –ø–æ–ª–Ω—ã–π user |
| `/tariffs` | GET | ‚ùå | `tariffs` | Array[Tariff] | –¶–µ–Ω—ã –≤ –∫–æ–ø–µ–π–∫–∞—Ö |
| `/nodes` | GET | ‚ùå | Hardcoded | Array[Node] | –ó–∞–≥–ª—É—à–∫–∞ |
| `/profile` | GET | ‚úÖ | `users`, `marzban_clients` | ProfileResponse | –î–≤–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö |
| `/profile/keys` | GET | ‚úÖ | `marzban_clients` | Array[MarzbanClient] | Marzban –∫–ª–∏–µ–Ω—Ç—ã |
| `/profile/usage` | GET | ‚úÖ | Marzban API | Usage (varies) | –§–æ—Ä–º–∞—Ç –∑–∞–≤–∏—Å–∏—Ç –æ—Ç Marzban |
| `/me/clients` | GET | ‚úÖ | `clients` | Array[Client] | –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—ã |
| `/me/clients` | POST | ‚úÖ | `clients` | CreateClientResponse | –°–æ–∑–¥–∞–µ—Ç –≤ `clients` |
| `/me/clients/:id/revoke` | POST | ‚úÖ | `clients` | 204 | –û–±–Ω–æ–≤–ª—è–µ—Ç status |
| `/vpn/config/:client_id` | GET | ‚úÖ | Marzban API | Config (varies) | –§–æ—Ä–º–∞—Ç –∑–∞–≤–∏—Å–∏—Ç –æ—Ç Marzban |
| `/payments/create` | POST | ‚úÖ | `invoices`, `payments` | PaymentResponse | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ |
| `/payments/:id` | GET | ‚úÖ | `invoices`, `payments` | InvoiceResponse | - |
| `/vpn/renew` | POST | ‚úÖ | `invoices`, `payments` | PaymentResponse | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç client_id |
| `/vpn/topup` | POST | ‚úÖ | `invoices`, `payments` | PaymentResponse | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç client_id |
| `/billing/state/:client_id` | GET | ‚úÖ | `client_billing_state` | BillingStateResponse | - |
| `/billing/history` | GET | ‚úÖ | `payments_log` | BillingHistoryResponse | –ü–∞–≥–∏–Ω–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç |
| `/referral/link` | GET | ‚úÖ | `users` | ReferralLinkResponse | - |
| `/referral/stats` | GET | ‚úÖ | `referrals`, `referral_rewards` | ReferralStatsResponse | - |
| `/referral/rewards` | GET | ‚úÖ | `referral_rewards` | ReferralRewardsResponse | –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è |
| `/configs/:client_id/*` | GET | ‚úÖ | `marzban_clients` | Blob (file) | Marzban ID –≤ path |

---

**–í–µ—Ä—Å–∏—è:** 1.0  
**–î–∞—Ç–∞:** 2024-11-18  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤—Å–µ—Ö endpoints

