# –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ API —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ endpoints

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

- ‚úÖ `POST /auth/login` - –í—Ö–æ–¥
- ‚úÖ `POST /auth/register` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è  
- ‚úÖ `POST /auth/refresh` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
- ‚úÖ `POST /auth/logout` - –í—ã—Ö–æ–¥

### –ü—É–±–ª–∏—á–Ω—ã–µ endpoints

- ‚úÖ `GET /tariffs` - –°–ø–∏—Å–æ–∫ —Ç–∞—Ä–∏—Ñ–æ–≤
- ‚úÖ `GET /nodes` - –°–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ endpoints

- ‚úÖ `GET /profile` - –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ `GET /profile/keys` - VPN –∫–ª—é—á–∏
- ‚úÖ `GET /profile/usage` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- ‚úÖ `GET /me/clients` - –°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤
- ‚úÖ `POST /me/clients` - –°–æ–∑–¥–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
- ‚úÖ `POST /me/clients/:id/revoke` - –û—Ç–∑—ã–≤ –∫–ª–∏–µ–Ω—Ç–∞
- ‚úÖ `GET /vpn/config/:client_id` - VPN –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ `POST /vpn/renew` - –ü—Ä–æ–¥–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏
- ‚úÖ `POST /vpn/topup` - –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞

### –ü–ª–∞—Ç–µ–∂–∏

- ‚úÖ `POST /payments/create` - –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞
- ‚úÖ `GET /payments/:id` - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–ª–∞—Ç–µ–∂–µ
- ‚úÖ `POST /payments/webhook` - Webhook –¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π

### –ë–∏–ª–ª–∏–Ω–≥

- ‚úÖ `GET /billing/state/:client_id` - –°–æ—Å—Ç–æ—è–Ω–∏–µ –±–∏–ª–ª–∏–Ω–≥–∞
- ‚úÖ `GET /billing/history` - –ò—Å—Ç–æ—Ä–∏—è –ø–ª–∞—Ç–µ–∂–µ–π

## ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏/–¥–æ—Ä–∞–±–æ—Ç–∫–∏

### 1. –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ `/auth/login` –∏ `/auth/register`

**–¢–µ–∫—É—â–∏–π —Ñ–æ—Ä–º–∞—Ç:**

```json
{
  "access_token": "...",
  "refresh_token": "...",
  "expires_in": 900,
  "refresh_expires_at": "2025-12-16T23:00:00Z",
  "user": {...},
  "roles": [...]
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç (–∏–∑ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏):**

```json
{
  "access_token": "...",
  "refresh_token": "...",
  "expires_in": 3600
}
```

**–†–µ—à–µ–Ω–∏–µ:** –§–æ—Ä–º–∞—Ç —É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, –Ω–æ –Ω—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ `expires_in` –≤ —Å–µ–∫—É–Ω–¥–∞—Ö.

---

### 2. –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ `/profile`

**–¢–µ–∫—É—â–∏–π —Ñ–æ—Ä–º–∞—Ç:**

```json
{
  "user": {
    "id": "...",
    "email": "...",
    "telegram_id": null,
    "roles": [...],
    "marzban_username": "..."
  },
  "stats": {
    "clients_total": 2
  },
  "clients": [...]
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç:** ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç

---

### 3. –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ `/profile/keys`

**–¢–µ–∫—É—â–∏–π —Ñ–æ—Ä–º–∞—Ç:** –ú–∞—Å—Å–∏–≤ `MarzbanClient` –æ–±—ä–µ–∫—Ç–æ–≤

**–û–∂–∏–¥–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç:**

```json
[
  {
    "id": "key_1",
    "user_id": "123",
    "marzban_client_id": "marzban_123",
    "protocol": "vless",
    "transport": "ws",
    "created_at": "2024-01-01T00:00:00Z",
    "expires_at": "2024-02-01T00:00:00Z",
    "active": true,
    "subscription_url": "https://example.com/sub",
    "config_text": "vless://..."
  }
]
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `MarzbanClient` —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è, –æ—Å–æ–±–µ–Ω–Ω–æ `config_text`.

---

### 4. –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ `/profile/usage`

**–¢–µ–∫—É—â–∏–π —Ñ–æ—Ä–º–∞—Ç:** –ó–∞–≤–∏—Å–∏—Ç –æ—Ç `Marzban.GetClientUsage()`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç:**

```json
{
  "client_id": "client_1",
  "up": 1073741824,
  "down": 2147483648,
  "total": 3221225472,
  "expires": "2024-02-01T00:00:00Z"
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç Marzban –∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ.

---

### 5. –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ `/me/clients`

**–¢–µ–∫—É—â–∏–π —Ñ–æ—Ä–º–∞—Ç:** –ú–∞—Å—Å–∏–≤ `MarzbanClient` –æ–±—ä–µ–∫—Ç–æ–≤

**–û–∂–∏–¥–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç:** ‚úÖ –î–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å `/profile/keys`

---

### 6. –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ `POST /me/clients`

**–¢–µ–∫—É—â–∏–π —Ñ–æ—Ä–º–∞—Ç:** –ó–∞–≤–∏—Å–∏—Ç –æ—Ç `ClientService.CreateClient()`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç:**

```json
{
  "client_id": "client_1",
  "uuid": "550e8400-e29b-41d4-a716-446655440000"
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞.

---

### 7. –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ `/vpn/config/:client_id`

**–¢–µ–∫—É—â–∏–π —Ñ–æ—Ä–º–∞—Ç:** –ó–∞–≤–∏—Å–∏—Ç –æ—Ç `Marzban.GetClient()`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç:**

```json
{
  "config": "vless://uuid@server:port?type=ws&path=/path#name",
  "subscription_url": "https://example.com/sub"
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞.

---

### 8. –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ `POST /payments/create`

**–¢–µ–∫—É—â–∏–π —Ñ–æ—Ä–º–∞—Ç:**

```json
{
  "invoice_id": "...",
  "payment_id": "...",
  "payment_url": "...",
  "provider_payment_id": "...",
  "status": "pending"
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç:** ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç

---

### 9. –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ `GET /payments/:id`

**–¢–µ–∫—É—â–∏–π —Ñ–æ—Ä–º–∞—Ç:**

```json
{
  "invoice": {...},
  "payments": [...]
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç:** ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç

---

### 10. –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ `POST /vpn/renew` –∏ `POST /vpn/topup`

**–¢–µ–∫—É—â–∏–π —Ñ–æ—Ä–º–∞—Ç:**

```json
{
  "invoice_id": "...",
  "payment_id": "...",
  "provider_payment_id": "...",
  "payment_url": "...",
  "status": "pending"
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç:** ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç

---

### 11. –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ `/billing/state/:client_id`

**–¢–µ–∫—É—â–∏–π —Ñ–æ—Ä–º–∞—Ç:**

```json
{
  "state": {...},
  "events": [...]
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç:** ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç

---

### 12. –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ `/billing/history`

**–¢–µ–∫—É—â–∏–π —Ñ–æ—Ä–º–∞—Ç:**

```json
{
  "page": 1,
  "limit": 20,
  "items": [...]
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç:** ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç

## üîß –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç `MarzbanClient`** - —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –ø–æ–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç `profile/usage`** - –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç Marzban

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç `POST /me/clients`** - —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç

4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç `/vpn/config/:client_id`** - –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç Marzban

5. **–î–æ–±–∞–≤–∏—Ç—å `config_text` –≤ –æ—Ç–≤–µ—Ç—ã –∫–ª–∏–µ–Ω—Ç–æ–≤** - –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –í—Å–µ —Å—É–º–º—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ –∫–æ–ø–µ–π–∫–∞—Ö (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
- –í—Å–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Å–µ–∫—É–Ω–¥–∞—Ö (–Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å)
- –î–∞—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ ISO 8601 (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
- CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ

